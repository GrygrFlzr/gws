FROM node:24-alpine

RUN corepack enable && corepack prepare pnpm@latest --activate

WORKDIR /app

COPY pnpm-lock.yaml pnpm-workspace.yaml package.json ./
COPY packages/core/package.json ./packages/core/

RUN pnpm install --frozen-lockfile --filter @gws/core

COPY packages/core ./packages/core

WORKDIR /app/packages/core

CMD ["pnpm", "db:migrate"]
